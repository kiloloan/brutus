<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRUTUS</title>
    <style>
        /* Variables */
        :root {
            --main-color: #f8b500;
            --text-shadow: 2px 2px 4px #000;
            --form-bg: #15172b;
            --input-bg: #303245;
            --transition: all 0.5s ease;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            color: #333;
        }
        h1 {
            color: var(--main-color);
            text-shadow: var(--text-shadow);
            display: inline;
        }
        form {
            background-color: var(--form-bg);
            border-radius: 20px;
            box-sizing: border-box;
            padding: 20px;
            width: 100%;
            max-width: 620px;
            color: #faa;
        }
        #divtitre {
            background: linear-gradient(60deg, #fceabb00 0%, #fccd4d44 12%, #f8b50022 12%, #fccd4dcc 20%, #f8b50066 20%, #fbdf9300 100%);
            display: block;
            margin-bottom: 20px;
            overflow: hidden; /* Nettoyage du flottement */
        }
        #languageButton{
            float: right; /* Flottement √† droite */
            height: 36px;
            width: 60px;
            padding: 0;
            border: none;
            cursor: pointer;
            background-color: transparent;
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            overflow: hidden;
            transition: all 1s linear;
        }
        .infos {
            display: inline;
            margin-left: 25px;
            font-size: 20px;
            color: #f8e5a5;
            text-shadow: 2px 2px 4px #000;
        }
        #log, .entree, .sortie {
            transition: var(--transition);
        }
        .entree {
            background: linear-gradient(135deg, #f3c5bd 0%, #e86c57 20%, #ea2803 11%, #ff6600 75%, #c72200 100%);
        }
        .sortie {
            background: linear-gradient(135deg, #c5f3bd 0%, #6ce857 20%, #28ea03 11%, #66ff00 75%, #22c700 100%);
        }
        #ROADMAP, #STATSDIV, #DEBUGDIV {
            display: none;
        }
        /* Formulaire dynamique */
        .input-container, .txt-container {
            position: relative;
            width: 100%;
            margin-top: 20px;
        }
        .input-container {
            height: 40px;
        }
        .txt-container {
            display: flex;
            align-items: flex-start;
        }
        .txt-container > .Champs {
            height: 100px;
            padding-top: 10px;
            font-size: 10px;
            color: #600;
        }
        .Champs {
            background-color: #303245;
            border-radius: 12px;
            border: 0;
            box-sizing: border-box;
            height: 100%;
            outline: 0;
            padding: 4px 20px 0;
            width: 100%;
        }
        .input-container > .Champs {
            font-size: 18px;
            color: #eee;
        }
        .cut {
            background-color: #15172b;
            border-radius: 10px;
            height: 20px;
            left: 20px;
            position: absolute;
            top: -20px;
            transform: translateY(0);
            transition: transform 200ms;
            width: 120px;
        }
        .cut-short {
            width: 50px;
        }
        .Champs:focus ~ .cut,
        .Champs:not(:placeholder-shown) ~ .cut {
            transform: translateY(8px);
        }
        .placeholder {
            color: #65657b;
            font-family: sans-serif;
            left: 20px;
            line-height: 14px;
            pointer-events: none;
            position: absolute;
            transform-origin: 0 50%;
            transition: transform 200ms, color 200ms;
            top: 15px;
        }
        .Champs:focus ~ .placeholder,
        .Champs:not(:placeholder-shown) ~ .placeholder {
            transform: translateY(-25px) translateX(10px) scale(0.75);
        }
        .Champs:not(:placeholder-shown) ~ .placeholder {
            color: #808097;
        }
        .Champs:focus ~ .placeholder {
            color: #dc2f55;
        }
        .entree:focus, .sortie:focus {
            font-size: 20px;
            height: 400px;
        }
        .entree {
            flex: 3;
            margin-right: 10px;
        }
        .button-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
            background-color: #121212;
            padding: 10px;
            border-radius: 10px;
        }
        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }
        #fileInput {
            opacity: 0;
            position: absolute;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        .file-label {
            display: inline-block;
            padding: 10px 10px;
            background-color: #1f1f1f;
            color: #00ffcc;
            border: 2px solid #00ffcc;
            border-radius: 5px;
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 120px;
            box-shadow: 0 6px 12px rgba(0, 255, 204, 0.3);
            transition: transform 0.3s, box-shadow 0.3s, color 0.3s;
            position: relative;
            z-index: 1;
            font-family: 'Courier New', Courier, monospace;
            font-size: 10px;
        }
        .file-label::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 255, 204, 0.1);
            border-radius: 5px;
            z-index: -1;
            transition: opacity 0.3s;
            opacity: 0;
        }
        .file-label:hover::before {
            opacity: 1;
        }
        .file-label:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 255, 204, 0.4);
            color: #ffffff;
        }
        .BTN {
            padding: 10px 20px;
            background-color: #1f1f1f;
            color: #ff4d4d;
            border: 2px solid #ff4d4d;
            border-radius: 5px;
            cursor: not-allowed;
            opacity: 0.5;
            box-shadow: 0 6px 12px rgba(255, 77, 77, 0.3);
            transition: transform 0.3s, box-shadow 0.3s, opacity 0.3s, color 0.3s;
            position: relative;
            z-index: 1;
            font-family: 'Courier New', Courier, monospace;
        }
        .BTN::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 77, 77, 0.1);
            border-radius: 5px;
            z-index: -1;
            transition: opacity 0.3s;
            opacity: 0;
        }
        .BTN.valid {
            cursor: pointer;
            opacity: 1;
        }
        .BTN.valid:hover::before {
            opacity: 1;
        }
        .BTN.valid:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(255, 77, 77, 0.4);
            color: #ffffff;
        }
        /* BOUTON AutoCrypt/Decrypt */
        .input-wrapper {
            position: relative;
            left: 40%;
            transform: translateX(-50%);
            display: inline-block;
        }
        .input-wrapper::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
            180deg,
            rgba(0, 255, 0, 0) 0%,
            rgba(0, 255, 0, 0.2) 50%,
            rgba(0, 255, 0, 0) 100%
            );
            animation: scan 3s linear infinite;
            z-index: 0;
        }
        #BTNautoCryDec {
            position: relative;
            background: transparent;
            padding: 10px 20px; /* ajustez selon vos besoins */
            z-index: 1;
        }
        @keyframes scan {
            0% {           transform: translateX(-30%) scaleX(0.3); }
            10% {          transform: translateX(-20%) scaleX(0.1); }
            20% {          transform: translateX(-0%) scaleX(0.1);  }
            40% {          transform: translateX(-15%) scaleX(0.4); }
            50% {          transform: translateX(20%) scaleX(0.2);  }
            60% {          transform: translateX(-5%) scaleX(0.05); }
            70% {          transform: translateX(25%) scaleX(0.5);  }
            80% {          transform: translateX(40%) scaleX(0.01); }
        }
        /* FIN BOUTON AutoCrypt/Decrypt */
        .txt-container:has(.entree:focus),
        .txt-container:has(.sortie:focus) {
            flex-direction: column;
        }
        /* CALENDRIERS */
        .date-range-wrapper {
            display: flex;
            width: 100%;
            gap: 20px;
            margin-top: 20px;
        }
        .date-range-wrapper .input-container {
            flex: 1;
            min-width: 0;
            position: relative;
            height: 52px;
            margin-top: 0;
        }
        .date-range-wrapper input[type="datetime-local"] {
            background-color: #303245;
            color: #eee;
            border: none;
            border-radius: 12px;
            padding: 18px 20px 5px;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px;
            height: 52px;

        }
        .date-range-wrapper input[type="datetime-local"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            padding: 4px;
            cursor: pointer;
            border-radius: 4px;
            margin-right: 2px;
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 40px;
            opacity: 0.5;
            transition: opacity 0.2s;
            font-size: 44px;
        }
        .date-range-wrapper input[type="datetime-local"]::-webkit-calendar-picker-indicator:hover {
            opacity: 1;
        }
        .date-range-wrapper .placeholder {
            position: absolute;
            left: 20px;
            top: 20px;
            color: #65657b;
            font-family: sans-serif;
            line-height: 14px;
            pointer-events: none;
            transition: all 0.2s ease;
            background-color: #15172b;
            padding: 0 5px;
            z-index: 1;
        }
        .date-range-wrapper .Champs[value] ~ .placeholder,
        .date-range-wrapper .Champs:not(:placeholder-shown) ~ .placeholder {
            transform: translateY(-25px) translateX(-10px) scale(0.75);
            color: #808097;
        }
        .date-range-wrapper .Champs:focus ~ .placeholder {
            transform: translateY(-25px) translateX(-10px) scale(0.75);
            color: #dc2f55;
        }
        .date-range-wrapper .cut {
            background-color: #15172b;
            border-radius: 10px;
            height: 20px;
            left: 20px;
            position: absolute;
            top: -20px;
            transform: translateY(0);
            transition: transform 200ms;
            width: 70px;
            z-index: 0;
        }
        .date-range-wrapper .Champs:focus ~ .cut,
        .date-range-wrapper .Champs[value] ~ .cut,
        .date-range-wrapper .Champs:not(:placeholder-shown) ~ .cut {
            transform: translateY(8px);
        }
        @-moz-document url-prefix() {
            .date-range-wrapper input[type="datetime-local"] {
                padding: 15px 20px 5px 20px;
                height: 52px;
            }
        }
        @-moz-document url-prefix() {
            .date-range-wrapper input[type="datetime-local"]::-moz-placeholder {
                color: #65657b;
                opacity: 1;
            }
        }
        @-moz-document url-prefix() {
            .date-range-wrapper input[type="datetime-local"] {
                text-indent: 0;
            }
        }
        /* Modernisation des options */
        fieldset {
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px;
            margin-top: 20px;
            background-color: #1e1e2c;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        legend {
            color: #f8b500;
            font-weight: bold;
            padding: 0 10px;
        }
        .Extra {
        color: white;
        font-family: monospace;
            font-size: smaller;
        }
        .Extra legend {
        background-color: black;
        }
        .options-container {
            display: flex;
            flex-direction: row;
            gap: 10px;
            align-items: flex-start;
        }
        .option-pair {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .option-group {
            display: flex;
            align-items: center;
            background-color: #2a2a3a;
            padding: 5px 8px;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }
        .option-group label {
            margin-left: 5px;
            color: #ddd;
            font-size: 12px;
            cursor: pointer;
        }
        .option-group input[type="checkbox"] {
            display: none;
        }
        .option-group svg {
            width: 14px;
            height: 14px;
            fill: #555;
            transition: fill 0.3s;
        }
        .option-group input[type="checkbox"]:checked + svg {
            fill: #00ffcc;
        }
        /* Ajout des styles pour le nouveau conteneur */
        .key-response-wrapper {
            display: flex;
            width: 100%;
            gap: 10px;
            margin-top: 20px;
        }
        .key-response-wrapper .input-container {
            margin-top: 0;
        }
        .key-response-wrapper .key-response-input:nth-child(1) {
            flex: 3; /* 75% */
        }
        .key-response-wrapper .key-response-input:nth-child(2) {
            flex: 1; /* 25% */
        }
    </style>
</head>
<body>
    <form name="formulaire" accept-charset="UTF-8" class="form">
        <div id="divtitre">
            <h1 id="titre">BRUTUS</h1>
            <a href="http://lesecretdunucleaire.free.fr/" target="_blank"><p class="infos">LSDN</p></a>
            <a href="https://github.com/kiloloan/brutus" target="_blank"><p class="infos">v 1.0</p></a>
            &nbsp; <progress id="BarProg" max="6" value="0" aria-label="Progression principale"></progress>
            <input id="languageButton" type="button" name="langue" value="FR" onclick="changeLanguage()" aria-label="FR/EN">
        </div>
        <div class="input-container">
            <input class="Champs" type="text" id="Clef" name="Clef" size="43" pattern="[^<>]*" value="" required aria-label="Question clef" placeholder=" " title="La question doit √™tre transmise √† l'interlocuteur">
            <div class="cut"></div>
            <label for="Clef" class="placeholder">Question clef</label>
        </div>
        <div class="key-response-wrapper">
            <div class="input-container key-response-input">
                <input class="Champs" type="text" id="ClefRep" name="ClefRep" size="43" pattern="[^<>]*" value="" required aria-label="R√©ponse clef" placeholder=" ">
                <div class="cut"></div>
                <label for="ClefRep" class="placeholder">R√©ponse clef</label>
            </div>
            <div class="input-container key-response-input">
                <input class="Champs" type="number" id="Puissance" name="Puissance" min="1" max="100" value="1" aria-label="Force du cryptage" placeholder=" ">
                <div class="cut"></div>
                <label for="Puissance" class="placeholder">Puissance</label>
            </div>
        </div>
        <div class="date-range-wrapper">
            <div class="input-container date-input">
                <input class="Champs" type="datetime-local" id="DateDebut" name="DateDebut" required>
                <div class="cut"></div>
                <label for="DateDebut" class="placeholder">Date de d√©but</label>
            </div>
            <div class="input-container date-input">
                <input class="Champs" type="datetime-local" id="DateFin" name="DateFin" required>
                <div class="cut"></div>
                <label for="DateFin" class="placeholder">Date de fin</label>
            </div>
        </div>
        <!-- ENTREE -->
        <div class="txt-container" id="containerEntree">
            <textarea id="txtareaentree" class="entree Champs" name="entree" rows="15" cols="60" pattern="[^<>]*" aria-label="Message d'entr√©e" placeholder=" " title="Brutus d√©tecte automatiquement s'il faut qu'il crypte ou d√©crypte le message"></textarea>
            <div class="cut"></div>
            <label for="txtareaentree" class="placeholder">Message d'entr√©e</label>
            <div class="button-container" id="BTNEntree">
                <div class="file-input-wrapper" id="fileInputDiv">
                    <input id="fileInput" type="file" accept=".txt" aria-label="Importer un fichier texte" />
                    <label for="fileInput" class="file-label" title="fichier texte uniquement. Vous pouvez convertir des fichiers en .txt si besoin">Charger un fichier</label>
                </div>
                <input id="fileInputLire" class="BTN BTLire" type="button" name="Lire" value="Lire" onclick="LireFichier()" aria-label="Lire le fichier" disabled>
            </div>
        </div>
        <!-- BOUTON DE CRYPTAGE / DECRYPTAGE -->
        <div class="input-wrapper" id="BTNautoCryDecDIV">
            <input id="BTNautoCryDec" class="BTN valid" type="button" name="Crypt" value="AutoCrypt/Decrypt" onclick="SuperCryDepter(formulaire, 1)" aria-label="Crypter/D√©crypter automatiquement">
        </div>
        <br/>
        <!-- SORTIE -->
        <div class="txt-container" id="containerSortie">
            <textarea id="txtareasortie" class="sortie Champs" name="sortie" rows="15" cols="60" readonly aria-label="Message de sortie" placeholder=" "></textarea>
            <div class="cut"></div>
            <label for="txtareasortie" class="placeholder">Message de sortie</label>
            <div class="button-container" id="BTNSortie">
                <input class="BTN valid" type="button" name="Sauvegarder" value="Exporter" onclick="SauverFichier()" aria-label="Sauvegarder le fichier" title="Sauvegarder le message de sortie dans un fichier .txt">
                <input class="BTN valid" type="button" name="Copie" value="Copier" onclick="CopyPressPapier()" aria-label="Copier la sortie dans le presse-papier">
            </div>
        </div>
        <fieldset>
            <legend>Options</legend>
            <div class="options-container">
                <div class="option-pair">
                    <div class="option-group">
                        <input type="checkbox" name="OpExportAuto" id="OpExportAuto" aria-label="Exporter automatiquement le fichier" />
                        <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>
                        <label for="OpExportAuto">Export auto en Fichier</label>
                    </div>
                    <div class="option-group">
                        <input type="checkbox" name="OpCC" id="OpCC" aria-label="Copier automatiquement dans le presse-papier" />
                        <svg viewBox="0 0 24 24"><path d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h1.18C7.6 4.84 8.7 5 10 5s2.4-.84 2.82-2H14c-.4 1.16-1.5 2-2.82 2-.5 0-.97.16-1.36.43-.95.65-1.36 1.64-1.36 2.84v11c0 .55.45 1 1 1h8c.55 0 1-.45 1-1V4h-2v16z"/></svg>
                        <label for="OpCC">Export auto dans le Presse papier</label>
                    </div>
                </div>
                <div class="option-pair">
                    <div class="option-group">
                        <input type="checkbox" name="OpMasqueTxtE" id="OpMasqueTxtE" onchange="MasqueTextArea()" aria-label="Masquer le texte d'entr√©e" />
                        <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
                        <label for="OpMasqueTxtE">Masquer Entr√©e</label>
                    </div>
                    <div class="option-group">
                        <input type="checkbox" name="OpMasqueTxtS" id="OpMasqueTxtS" onchange="MasqueTextArea()" aria-label="Masquer le texte de sortie" />
                        <svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
                        <label for="OpMasqueTxtS">Masquer Sortie</label>
                    </div>
                </div>
                <div class="option-pair">
                    <div class="option-group">
                        <input type="checkbox" name="OpStats" id="OpStats" onchange="AfficheStatsDIV()" aria-label="Afficher les statistiques" />
                        <svg viewBox="0 0 24 24"><path d="M3 3v18h18V3H3zm4 16V7h2v12H7zm4 0V3h2v16h-2zm4 0V11h2v8h-2z"/></svg>
                        <label for="OpStats">Affichage Statistiques</label>
                    </div>
                    <div class="option-group">
                        <input type="checkbox" name="OpDebug" id="OpDebug" onchange="AfficheDebug()" aria-label="Activer le mode debug" />
                        <svg viewBox="0 0 24 24"><path d="M22 13h-8v-2h8v2zm0-6h-8v2h8V7zm-8 10h8v-2h-8v2zm-2-8v-4l-6 5 6 5v-4h-4v-2h4zm-6-6h2v2h-2V5zm0 10h2v2h-2v-2z"/></svg>
                        <label for="OpDebug">Affichage Debug</label>
                    </div>
                    <div class="option-group">
                        <input type="checkbox" name="OpRoadmap" id="OpRoadmap" onchange="AfficheRoadMap()" aria-label="Afficher la roadmap" />
                        <svg viewBox="0 0 24 24"><path d="M20.29 9.21l-1.42-1.42-3.54 3.54-2.58-2.58-1.42 1.42 2.58 2.58 3.54-3.54zm-6.46 5.71l1.42 1.42 3.54-3.54 2.58 2.58 1.42-1.42-2.58-2.58-3.54 3.54zM4 11h10v2H4z"/></svg>
                        <label for="OpRoadmap">Affichage ChangeLog</label>
                    </div>
                </div>
            </div>
        </fieldset>
    </form>
    <div id="STATSDIV">
        <fieldset class="Extra">
            <legend>Stats</legend>
            <div id="Stats" aria-label="Statistiques">
            </div>
        </fieldset>
    </div>
    <div id="DEBUGDIV">
        <fieldset class="Extra">
            <legend>Debug</legend>
            <div id="Log" aria-label="Traitement"></div>
        </fieldset>
    </div>
    <div id="ROADMAP">
        <fieldset class="Extra">
            <legend>ChangeLog</legend>
            * 0.2 ) progress bar ou meter
            <br />* 0.3 ) css
            <br />* 0.3.1 ) debug en option
            <br />* 0.3.2 ) fusion de la fonction crypt/decrypt
            <br />* 0.3.3 ) textarea masquables
            <br />* 0.4 ) export / import de fichier + (option auto Export)
            <br />* 0.4.1 ) option :  textarea dans CC
            <br />* 0.5 ) optimisation du code. correction des retours chariots. Passage en UTF8
            <br />* 0.6 ) interdire les clefs vides
            <br />* 0.7 ) ajout de la puissance du cryptage
            <br />* 0.8 ) interdire l'import de fichier non *.txt / 8.2 Aide Infobulles
            <br />* 0.9 ) faire des messages √† dur√©e limit√©e
            <br />* 0.92) Am√©lioration de l'interface (options de masquages)
            <br />* 0.94) traduction + amelioration focus
            <br />* 0.95) finalisation CSS
            <br />* 1.0 ) release
            <br /> ToDo :::
            <br />* ...
        </fieldset>
    </div>
    <script>
        const hex_chr = "0123456789abcdef";
        const PREFIXE = "Õªœ†Õ≥";
        const DATE_PREFIX = "Õ≥œ†[";
        const DATE_SUFFIX = "]Õ≥Õª";
        const DATE_SEPARATION = "]Õ≥Õ≥[";
        const UNICODE_MAX = 0x10FFFF;
        // Variable globale pour stocker l'heure du serveur
        let serverTimeCached = null;
        // Fonction pour formater la date au format souhait√©
        function formatDateForCrypt(date) {
            const year = date.getUTCFullYear();
            const month = String(date.getUTCMonth() + 1).padStart(2, '0');
            const day = String(date.getUTCDate()).padStart(2, '0');
            const hours = String(date.getUTCHours()).padStart(2, '0');
            const minutes = String(date.getUTCMinutes()).padStart(2, '0');
            const seconds = String(date.getUTCSeconds()).padStart(2, '0');
            return `${year}${month}${day}${hours}${minutes}${seconds}`;
        }
        // Fonction pour mettre √† jour l'heure du serveur
        async function updateServerTime() {
            try {
                const response = await fetch('https://worldtimeapi.org/api/timezone/Etc/UTC');
                if (response.ok) {
                    const data = await response.json();
                    const utcDate = new Date(data.datetime);
                    serverTimeCached = formatDateForCrypt(utcDate);
                    console.log("Heure du serveur mise √† jour");
                }
            } catch (error) {
                console.error('Erreur lors de la r√©cup√©ration de l\'heure UTC depuis le serveur :', error);
            }
        }
        // Fonction synchrone pour obtenir l'heure UTC (avec cache)
        function getUTCDateTimeSync() {
            // Si on a une heure de serveur en cache, l'utiliser
            if (serverTimeCached) {
                return serverTimeCached;
            }
            // Sinon, utiliser l'heure locale
            const now = new Date();
            return formatDateForCrypt(new Date(Date.UTC(
                now.getUTCFullYear(),
                now.getUTCMonth(),
                now.getUTCDate(),
                now.getUTCHours(),
                now.getUTCMinutes(),
                now.getUTCSeconds()
            )));
        }
        // Mettre √† jour l'heure du serveur imm√©diatement et p√©riodiquement
        updateServerTime();
        setInterval(updateServerTime, 5 * 60 * 1000); // Mettre √† jour toutes les 5 minutes
        function rhex(num) {
        let str = "";
        for (let j = 0; j <= 3; j++) {
            str += hex_chr[(num >> (j * 8 + 4)) & 0x0F] + hex_chr[(num >> (j * 8)) & 0x0F];
        }
        return str;
        }
        function str2blks_MD5(str) {
        const nblk = ((str.length + 8) >> 6) + 1;
        const blks = new Uint32Array(nblk * 16);
        for (let i = 0; i < str.length; i++) {
            blks[i >> 2] |= str.charCodeAt(i) << ((i % 4) * 8);
        }
        const i = str.length;
        blks[i >> 2] |= 0x80 << ((i % 4) * 8);
        blks[nblk * 16 - 2] = str.length * 8;
        return blks;
        }
        function add(x, y) {
        return (x + y) & 0xFFFFFFFF;
        }
        function rol(num, cnt) {
        return (num << cnt) | (num >>> (32 - cnt));
        }
        function cmn(q, a, b, x, s, t) {
        return add(rol(add(add(a, q), add(x, t)), s), b);
        }
        function ff(a, b, c, d, x, s, t) {
        return cmn((b & c) | ((~b) & d), a, b, x, s, t);
        }
        function gg(a, b, c, d, x, s, t) {
        return cmn((b & d) | (c & (~d)), a, b, x, s, t);
        }
        function hh(a, b, c, d, x, s, t) {
        return cmn(b ^ c ^ d, a, b, x, s, t);
        }
        function ii(a, b, c, d, x, s, t) {
        return cmn(c ^ (b | (~d)), a, b, x, s, t);
        }
        function calcMD5(str) {
        const x = str2blks_MD5(str);
        let a = 0x67452301;
        let b = 0xEFCDAB89;
        let c = 0x98BADCFE;
        let d = 0x10325476;
        for (let i = 0; i < x.length; i += 16) {
            let olda = a;
            let oldb = b;
            let oldc = c;
            let oldd = d;
            a = ff(a, b, c, d, x[i + 0], 7, -680876936);
            d = ff(d, a, b, c, x[i + 1], 12, -389564586);
            c = ff(c, d, a, b, x[i + 2], 17, 606105819);
            b = ff(b, c, d, a, x[i + 3], 22, -1044525330);
            a = ff(a, b, c, d, x[i + 4], 7, -176418897);
            d = ff(d, a, b, c, x[i + 5], 12, 1200080426);
            c = ff(c, d, a, b, x[i + 6], 17, -1473231341);
            b = ff(b, c, d, a, x[i + 7], 22, -45705983);
            a = ff(a, b, c, d, x[i + 8], 7, 1770035416);
            d = ff(d, a, b, c, x[i + 9], 12, -1958414417);
            c = ff(c, d, a, b, x[i + 10], 17, -42063);
            b = ff(b, c, d, a, x[i + 11], 22, -1990404162);
            a = ff(a, b, c, d, x[i + 12], 7, 1804603682);
            d = ff(d, a, b, c, x[i + 13], 12, -40341101);
            c = ff(c, d, a, b, x[i + 14], 17, -1502002290);
            b = ff(b, c, d, a, x[i + 15], 22, 1236535329);
            a = gg(a, b, c, d, x[i + 1], 5, -165796510);
            d = gg(d, a, b, c, x[i + 6], 9, -1069501632);
            c = gg(c, d, a, b, x[i + 11], 14, 643717713);
            b = gg(b, c, d, a, x[i + 0], 20, -373897302);
            a = gg(a, b, c, d, x[i + 5], 5, -701558691);
            d = gg(d, a, b, c, x[i + 10], 9, 38016083);
            c = gg(c, d, a, b, x[i + 15], 14, -660478335);
            b = gg(b, c, d, a, x[i + 4], 20, -405537848);
            a = gg(a, b, c, d, x[i + 9], 5, 568446438);
            d = gg(d, a, b, c, x[i + 14], 9, -1019803690);
            c = gg(c, d, a, b, x[i + 3], 14, -187363961);
            b = gg(b, c, d, a, x[i + 8], 20, 1163531501);
            a = gg(a, b, c, d, x[i + 13], 5, -1444681467);
            d = gg(d, a, b, c, x[i + 2], 9, -51403784);
            c = gg(c, d, a, b, x[i + 7], 14, 1735328473);
            b = gg(b, c, d, a, x[i + 12], 20, -1926607734);
            a = hh(a, b, c, d, x[i + 5], 4, -378558);
            d = hh(d, a, b, c, x[i + 8], 11, -2022574463);
            c = hh(c, d, a, b, x[i + 11], 16, 1839030562);
            b = hh(b, c, d, a, x[i + 14], 23, -35309556);
            a = hh(a, b, c, d, x[i + 1], 4, -1530992060);
            d = hh(d, a, b, c, x[i + 4], 11, 1272893353);
            c = hh(c, d, a, b, x[i + 7], 16, -155497632);
            b = hh(b, c, d, a, x[i + 10], 23, -1094730640);
            a = hh(a, b, c, d, x[i + 13], 4, 681279174);
            d = hh(d, a, b, c, x[i + 0], 11, -358537222);
            c = hh(c, d, a, b, x[i + 3], 16, -722521979);
            b = hh(b, c, d, a, x[i + 6], 23, 76029189);
            a = hh(a, b, c, d, x[i + 9], 4, -640364487);
            d = hh(d, a, b, c, x[i + 12], 11, -421815835);
            c = hh(c, d, a, b, x[i + 15], 16, 530742520);
            b = hh(b, c, d, a, x[i + 2], 23, -995338651);
            a = ii(a, b, c, d, x[i + 0], 6, -198630844);
            d = ii(d, a, b, c, x[i + 7], 10, 1126891415);
            c = ii(c, d, a, b, x[i + 14], 15, -1416354905);
            b = ii(b, c, d, a, x[i + 5], 21, -57434055);
            a = ii(a, b, c, d, x[i + 12], 6, 1700485571);
            d = ii(d, a, b, c, x[i + 3], 10, -1894986606);
            c = ii(c, d, a, b, x[i + 10], 15, -1051523);
            b = ii(b, c, d, a, x[i + 1], 21, -2054922799);
            a = ii(a, b, c, d, x[i + 8], 6, 1873313359);
            d = ii(d, a, b, c, x[i + 15], 10, -30611744);
            c = ii(c, d, a, b, x[i + 6], 15, -1560198380);
            b = ii(b, c, d, a, x[i + 13], 21, 1309151649);
            a = ii(a, b, c, d, x[i + 4], 6, -145523070);
            d = ii(d, a, b, c, x[i + 11], 10, -1120210379);
            c = ii(c, d, a, b, x[i + 2], 15, 718787259);
            b = ii(b, c, d, a, x[i + 9], 21, -343485551);
            a = add(a, olda);
            b = add(b, oldb);
            c = add(c, oldc);
            d = add(d, oldd);
        }
        return rhex(a) + rhex(b) + rhex(c) + rhex(d);
        }
        function crypterUTF8(message, cle, puissance) {
        let messageCrypte = message;
        for (let p = 0; p < puissance; p++) {
            messageCrypte = "";
            for (let i = 0; i < message.length; i++) {
            const code = message.charCodeAt(i);
            const codeCrypte = (code + cle + i) % (UNICODE_MAX + 1);
            messageCrypte += String.fromCharCode(codeCrypte);
            }
            message = messageCrypte;
        }
        return messageCrypte;
        }
        // Sous-fonction pour le d√©cryptage du message
        function decrypterUTF8_SF(message, cle, puissance) {
            let messageDecrypte = message;
            for (let p = 0; p < puissance; p++) {
                let tempMessage = "";
                for (let i = 0; i < messageDecrypte.length; i++) {
                    const codeCrypte = messageDecrypte.charCodeAt(i);
                    const codeDecrypte = (codeCrypte - cle - i + UNICODE_MAX + 1) % (UNICODE_MAX + 1);
                    tempMessage += String.fromCharCode(codeDecrypte);
                }
                messageDecrypte = tempMessage;
            }
            return messageDecrypte;
        }
        function decrypterUTF8(messageCrypte, cle, puissance) {
            // Enlever le pr√©fixe global si pr√©sent
            let messageSansPrefixe = messageCrypte.startsWith(PREFIXE) ?
                messageCrypte.substring(PREFIXE.length) : messageCrypte;
            // Initialiser les variables pour les dates et le message
            let dateDebut = "";
            let dateFin = "";
            let message = messageSansPrefixe; // Par d√©faut, tout est consid√©r√© comme message
            // Trouver la date de d√©but si possible
            const startDateDebut = messageSansPrefixe.indexOf(DATE_PREFIX);
            if (startDateDebut !== -1) {
                const startDateDebutContent = startDateDebut + DATE_PREFIX.length;
                const endDateDebut = messageSansPrefixe.indexOf(']', startDateDebutContent);
                if (endDateDebut !== -1) {
                    dateDebut = messageSansPrefixe.substring(startDateDebutContent, endDateDebut);
                    // Trouver la date de fin si possible
                    const startDateFin = messageSansPrefixe.indexOf(DATE_SEPARATION, endDateDebut);
                    if (startDateFin !== -1) {
                        const startDateFinContent = startDateFin + DATE_SEPARATION.length;
                        const endDateFin = messageSansPrefixe.indexOf(']', startDateFinContent);
                        if (endDateFin !== -1) {
                            dateFin = messageSansPrefixe.substring(startDateFinContent, endDateFin);
                            // Trouver le message crypt√© apr√®s DATE_SUFFIX si possible
                            const startSuffix = messageSansPrefixe.indexOf(DATE_SUFFIX, endDateFin);
                            if (startSuffix !== -1) {
                                const startMessage = startSuffix + DATE_SUFFIX.length;
                                message = messageSansPrefixe.substring(startMessage);
                            }
                        }
                    }
                }
            }
            // Obtenir la date de contr√¥le (utilise le cache si disponible)
            const dateControl = getUTCDateTimeSync();
            // D√©crypter les dates
            dateDebut = decrypterUTF8_SF(dateDebut, cle, puissance * 2);
            dateFin = decrypterUTF8_SF(dateFin, cle, puissance * 3);
            AfficheTraitement("DC : " + dateControl, true);
            AfficheTraitement("D0 : " + dateDebut, true);
            AfficheTraitement("DF : " + dateFin, true);
            //test la position de DC par rapport √† D0 et DF
                const dcValue = parseInt(dateControl);
                const d0Value = parseInt(dateDebut);
                const dfValue = parseInt(dateFin);
                if(dcValue >= d0Value && dcValue <= dfValue)  {
                // Appel de la sous-fonction pour d√©crypter le message
                AfficheTraitement("OK", true);
                return decrypterUTF8_SF(message, cle, puissance);
                }
            else {
                AfficheTraitement("NOK", true);
                return crypterUTF8(message, cle, puissance);
            }
        }
        function SuperCryDepter(formulaire, Mode) {
        const debut = performance.now();
        AfficheStats(debut);
        requestAnimationFrame(() => CryDepter(formulaire, Mode));
        }
        async function CryDepter(formulaire, Mode) {
        const debut = performance.now();
        AfficheStats(debut);
        Etape(0);
            let Message = document.formulaire.entree.value;
            const dateDebut = document.formulaire.DateDebut.value;
            const dateFin = document.formulaire.DateFin.value;
            const ClefQue = document.formulaire.Clef.value;
            const ClefRep = document.formulaire.ClefRep.value;
            const Puissance = parseInt(document.formulaire.Puissance.value, 10);
            if (!ClefQue || !ClefRep) {
            alert("Les cl√©s ne peuvent pas √™tre vides.");
            return;
            }
            const tailleClefQue = ClefQue.length;
            const tailleClefRep = ClefRep.length;
        Etape(1);
            const Clef = calcMD5(ClefQue + ClefRep + tailleClefQue + tailleClefRep);
            AfficheTraitement(Clef, true);
        Etape(2);
            const cleNumerique = Clef.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            AfficheTraitement(cleNumerique, true);
        Etape(3);
            if (Message.startsWith(PREFIXE)) {
            Mode = 2;
            Message = Message.substring(PREFIXE.length);
            }
            if (Mode === 1) {
            //codage des dates//
                const formattedDateDebut = formatDateForCrypt(new Date(dateDebut));
                const formattedDateFin = formatDateForCrypt(new Date(dateFin));
                AfficheTraitement("D0=" + formattedDateDebut, true);
                AfficheTraitement("DF=" + formattedDateFin, true);
                Message = PREFIXE + DATE_PREFIX + crypterUTF8(formattedDateDebut, cleNumerique, Puissance * 2) +
                        DATE_SEPARATION + crypterUTF8(formattedDateFin, cleNumerique, Puissance * 3) +
                        DATE_SUFFIX + crypterUTF8(Message, cleNumerique, Puissance);
            } else {
            Message = decrypterUTF8(Message, cleNumerique, Puissance);
            }
            AfficheTraitement(Message, true);
        Etape(4);
            document.formulaire.sortie.value = Message;
            const fin = performance.now();
            AfficheStats(fin);
            const duree = fin - debut;
        Etape(5);
            AfficheStats(duree);
            if (document.formulaire.OpExportAuto.checked) {
            SauverFichier();
            }
            if (document.formulaire.OpCC.checked) {
            CopyPressPapier();
            }
        Etape(6);
        }
        function Etape(avancement) {
        document.getElementById("BarProg").value = avancement;
        }
        function AfficheTraitement(valeur, Saut) {
        if (document.formulaire.OpDebug.checked) {
            Saut = Saut || "//  ";
            if (Saut === true) {
            Saut = "<br />----------------------<br />";
            }
            const Ancien = document.getElementById("Log").innerHTML;
            document.getElementById("Log").innerHTML = Ancien + Saut + valeur + Saut;
        }
        }
        function AfficheStats(valeur) {
        if (document.formulaire.OpStats.checked) {
            const Ancien = document.getElementById("Stats").innerHTML;
            valeur = Math.round(valeur * 100) / 100;
            document.getElementById("Stats").innerHTML = Ancien + valeur + "ms .. ";
        }
        }
        function MasqueTextArea() {
        document.getElementById("txtareaentree").style.filter = document.formulaire.OpMasqueTxtE.checked ? "blur(5px) saturate(0.5)" : "";
            document.getElementById("txtareasortie").style.filter = document.formulaire.OpMasqueTxtS.checked ? "blur(5px) saturate(0.5)" : "";
        }
        function AfficheRoadMap() {
        document.getElementById("ROADMAP").style.display = document.formulaire.OpRoadmap.checked ? "block" : "none";
        }
        function AfficheStatsDIV() {
        document.getElementById("STATSDIV").style.display = document.formulaire.OpStats.checked ? "block" : "none";
        }
        function AfficheDebug() {
        document.getElementById("DEBUGDIV").style.display = document.formulaire.OpDebug.checked ? "block" : "none";
        }
        function SauverFichier() {
        const data = document.formulaire.sortie.value;
        const blob = new Blob([data], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'message_crypte.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        }
        function CopyPressPapier() {
        document.formulaire.sortie.select();
        document.execCommand('copy');
        }
        function validerEntree(input) {
        const regex = /[<>]/g;
        input.value = input.value.replace(regex, '');
        }
        document.querySelectorAll('input[pattern], textarea[pattern]').forEach(input => {
        input.addEventListener('input', () => validerEntree(input));
        });
        function LireFichier() {
        const reader = new FileReader();
        reader.addEventListener('load', function () {
            document.formulaire.entree.value = reader.result;
        });
        const fileInput = document.getElementById('fileInput');
        if (fileInput.files[0] && fileInput.files[0].type !== "text/plain") {
            alert("Seuls les fichiers .txt sont autoris√©s.");
            fileInput.value = '';
            return;
        }
        reader.readAsText(fileInput.files[0]);
        }
        const fileInput = document.getElementById('fileInput');
        const fileLabel = document.querySelector('.file-label');
        const readButton = document.querySelector('.BTLire');
        fileInput.addEventListener('change', function() {
        const file = fileInput.files[0];
        if (file) {
            const fileName = file.name.length > 16 ? file.name.substring(0, 16) + '...' : file.name;
            fileLabel.textContent = fileName;
            const fileSize = (file.size / 1024).toFixed(1);
            readButton.value = `Lire (${fileSize}Ko)`;
            readButton.classList.add('valid');
            readButton.disabled = false;
        } else {
            fileLabel.textContent = 'Choisir un fichier';
            readButton.value = 'Lire';
            readButton.classList.remove('valid');
            readButton.disabled = true;
        }
        });
        // Gestion des date pickers
        document.addEventListener('DOMContentLoaded', function() {
        const dateDebutInput = document.getElementById('DateDebut');
        const dateFinInput = document.getElementById('DateFin');
        const maintenant = new Date();
        // Initialisation avec des valeurs par d√©faut
        dateDebutInput.value = maintenant.toISOString().slice(0, 16);
        // Date de fin par d√©faut : 1 an apr√®s la date de d√©but
        const dateFinDefaut = new Date(maintenant.getTime() + 100 * 365.25 * 24 * 60 * 60 * 1000);
        dateFinInput.value = dateFinDefaut.toISOString().slice(0, 16);
        // Validation crois√©e
        function validerDates() {
            const debut = new Date(dateDebutInput.value);
            const fin = new Date(dateFinInput.value);
            if (fin < debut) {
            const nouvelleFin = new Date(debut.getTime() + 24 * 60 * 60 * 1000);
            dateFinInput.value = nouvelleFin.toISOString().slice(0, 16);
            }
        }
        dateDebutInput.addEventListener('change', validerDates);
        dateFinInput.addEventListener('change', function() {
            const debut = new Date(dateDebutInput.value);
            const fin = new Date(this.value);
            if (fin < debut) {
            alert("La date de fin doit √™tre post√©rieure √† la date de d√©but.");
            const nouvelleFin = new Date(debut.getTime() + 24 * 60 * 60 * 1000);
            this.value = nouvelleFin.toISOString().slice(0, 16);
            }
        });
        // Ajout de la classe "not-empty" pour g√©rer le style des labels
        dateDebutInput.addEventListener('input', function() {
            this.classList.toggle('not-empty', this.value !== '');
        });
        dateFinInput.addEventListener('input', function() {
            this.classList.toggle('not-empty', this.value !== '');
        });
        // Initialisation des classes
        dateDebutInput.classList.add('not-empty');
        dateFinInput.classList.add('not-empty');
        });
        // Fonctions de traduction
        const languages = {
            fr: {
                TxTtitre: "BRUTUS",
                TxTinfos1: "LSDN",
                TxTprogressLabel: "Progression principale",
                TxTclefPlaceholder: "Question clef",
                TxTclefRepPlaceholder: "R√©ponse clef",
                TxTpuissancePlaceholder: "Puissance",
                TxTdateDebutPlaceholder: "Date de d√©but",
                TxTdateFinPlaceholder: "Date de fin",
                TxTtxtareaentreePlaceholder: "Message d'entr√©e",
                TxTtxtareasortiePlaceholder: "Message de sortie",
                TxTlireCharge: "üìÅOuvrir",
                TxTlireButton: "Lire",
                TxTautoCryptButton: "AutoCrypt/Decrypt",
                TxTsauvegarderButton: "üíæExporter",
                TxTcopieButton: "‚úÇÔ∏èCopier",
                TxTOpExportAuto: "Export auto en Fichier",
                TxTOpCC: "Export auto dans le Presse papier",
                TxTOpMasqueTxtE: "Masquer Entr√©e",
                TxTOpMasqueTxtS: "Masquer Sortie",
                TxTOpStats: "Affichage Statistiques",
                TxTOpDebug: "Affichage Debug",
                TxTOpRoadmap: "Affichage ChangeLog",
                TxTOptionsLegend: "Options",
                TxTstatsLegend: "Stats",
                TxTdebugLegend: "Debug",
                TxTroadmapLegend: "ChangeLog",
                TxTclefTitle: "La question doit √™tre transmise √† l'interlocuteur",
                TxTclefRepTitle: "La r√©ponse doit √™tre connue de l'interlocuteur, et de pr√©f√©rence de lui seul",
                TxTpuissanceTitle: "Chiffre √©lev√© = Augmente la s√©curit√©, ‚ùómais augmente le risque d'erreurs et le temps de traitement",
                TxTtxtareaentreeTitle: "Brutus d√©tecte automatiquement s'il faut qu'il crypte ou d√©crypte le message",
                TxTfileInputTitle: "fichier texte uniquement. Vous pouvez convertir des fichiers en .txt si besoin",
                TxTsauvegarderTitle: "Sauvegarder le message de sortie dans un fichier .txt"
            },
            en: {
                TxTtitre: "BRUTUS",
                TxTinfos1: "LSDN",
                TxTprogressLabel: "Main Progress",
                TxTclefPlaceholder: "Key Question",
                TxTclefRepPlaceholder: "Key Answer",
                TxTpuissancePlaceholder: "Power",
                TxTdateDebutPlaceholder: "Start Date",
                TxTdateFinPlaceholder: "End Date",
                TxTtxtareaentreePlaceholder: "Input Message",
                TxTtxtareasortiePlaceholder: "Output Message",
                TxTlireCharge: "üìÅOpen",
                TxTlireButton: "Read",
                TxTautoCryptButton: "AutoCrypt/Decrypt",
                TxTsauvegarderButton: "üíæExport",
                TxTcopieButton: "‚úÇÔ∏èCopy",
                TxTOpExportAuto: "Auto Export to File",
                TxTOpCC: "Auto Copy to Clipboard",
                TxTOpMasqueTxtE: "Hide Input",
                TxTOpMasqueTxtS: "Hide Output",
                TxTOpStats: "Display Statistics",
                TxTOpDebug: "Display Debug",
                TxTOpRoadmap: "Display ChangeLog",
                TxTOptionsLegend: "Options",
                TxTstatsLegend: "Stats",
                TxTdebugLegend: "Debug",
                TxTroadmapLegend: "ChangeLog",
                TxTclefTitle: "The question must be transmitted to the interlocutor",
                TxTclefRepTitle: "The answer must be known to the interlocutor, and preferably only to him",
                TxTpuissanceTitle: "High number = Increases security, ‚ùóbut increases the risk of errors and processing time",
                TxTtxtareaentreeTitle: "Brutus automatically detects whether it needs to encrypt or decrypt the message",
                TxTfileInputTitle: "Text file only. You can convert files to .txt if needed",
                TxTsauvegarderTitle: "Save the output message in a .txt file"
            }
        };
        let currentLanguage = 'fr';
        function getFrenchFlagSVG() {
            return 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="20" viewBox="0 0 30 20"><rect width="10" height="20" fill="%230055A4"/><rect x="10" width="10" height="20" fill="%23FFFFFF"/><rect x="20" width="10" height="20" fill="%23EF4135"/></svg>';
        }
        function getBritishFlagSVG() {
            return 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60" width="120" height="60"><clipPath id="t"><path d="M60,30 h60 v30 z v30 h-60 z h-60 v-30 z v-30 h60 z"/></clipPath><path d="M0,0 v60 h120 v-60 z" fill="%2300247d"/><path d="M0,0 L120,60 M120,0 L0,60" stroke="white" stroke-width="12"/><path d="M0,0 L120,60 M120,0 L0,60" clip-path="url(%23t)" stroke="%23cf142b" stroke-width="8"/><path d="M60,0 v60 M0,30 h120" stroke="white" stroke-width="20"/><path d="M60,0 v60 M0,30 h120" stroke="%23cf142b" stroke-width="12"/></svg>';
        }
        function changeLanguage() {
            currentLanguage = currentLanguage === 'fr' ? 'en' : 'fr';
            updateTexts();
        }
        function updateTexts() {
            const lang = languages[currentLanguage];
            // Mettre √† jour les titres et paragraphes
            document.getElementById('titre').textContent = lang.TxTtitre;
            //document.querySelectorAll('.infos')[0].textContent = lang.TxTinfos1;
            document.getElementById('BarProg').setAttribute('aria-label', lang.TxTprogressLabel);
            // Mettre √† jour les placeholders et labels des champs de formulaire
            document.querySelector('label[for="Clef"]').textContent = lang.TxTclefPlaceholder;
            document.getElementById('Clef').setAttribute('placeholder', ' ');
            document.getElementById('Clef').setAttribute('aria-label', lang.TxTclefPlaceholder);
            document.getElementById('Clef').setAttribute('title', lang.TxTclefTitle);
            document.querySelector('label[for="ClefRep"]').textContent = lang.TxTclefRepPlaceholder;
            document.getElementById('ClefRep').setAttribute('placeholder', ' ');
            document.getElementById('ClefRep').setAttribute('aria-label', lang.TxTclefRepPlaceholder);
            document.getElementById('ClefRep').setAttribute('title', lang.TxTclefRepTitle);
            document.querySelector('label[for="Puissance"]').textContent = lang.TxTpuissancePlaceholder;
            document.getElementById('Puissance').setAttribute('placeholder', ' ');
            document.getElementById('Puissance').setAttribute('aria-label', lang.TxTpuissancePlaceholder);
            document.getElementById('Puissance').setAttribute('title', lang.TxTpuissanceTitle);
            document.querySelector('label[for="DateDebut"]').textContent = lang.TxTdateDebutPlaceholder;
            document.getElementById('DateDebut').setAttribute('aria-label', lang.TxTdateDebutPlaceholder);
            document.querySelector('label[for="DateFin"]').textContent = lang.TxTdateFinPlaceholder;
            document.getElementById('DateFin').setAttribute('aria-label', lang.TxTdateFinPlaceholder);
            document.querySelector('label[for="txtareaentree"]').textContent = lang.TxTtxtareaentreePlaceholder;
            document.getElementById('txtareaentree').setAttribute('placeholder', ' ');
            document.getElementById('txtareaentree').setAttribute('aria-label', lang.TxTtxtareaentreePlaceholder);
            document.getElementById('txtareaentree').setAttribute('title', lang.TxTtxtareaentreeTitle);
            document.querySelector('label[for="txtareasortie"]').textContent = lang.TxTtxtareasortiePlaceholder;
            document.getElementById('txtareasortie').setAttribute('placeholder', ' ');
            document.getElementById('txtareasortie').setAttribute('aria-label', lang.TxTtxtareasortiePlaceholder);
            // Mettre √† jour les boutons
            document.querySelector('label[for="fileInput"]').textContent = lang.TxTlireCharge;
            document.querySelector('input[name="Lire"]').value = lang.TxTlireButton;
            document.querySelector('input[name="Crypt"]').value = lang.TxTautoCryptButton;
            document.querySelector('input[name="Sauvegarder"]').value = lang.TxTsauvegarderButton;
            document.querySelector('input[name="Copie"]').value = lang.TxTcopieButton;
            // Mettre √† jour les attributs title des boutons
            document.querySelector('input[name="Sauvegarder"]').setAttribute('title', lang.TxTsauvegarderTitle);
            document.querySelector('label[for="fileInput"]').setAttribute('title', lang.TxTfileInputTitle);
            // Mettre √† jour les labels des options
            document.querySelector('label[for="OpExportAuto"]').textContent = lang.TxTOpExportAuto;
            document.querySelector('label[for="OpCC"]').textContent = lang.TxTOpCC;
            document.querySelector('label[for="OpMasqueTxtE"]').textContent = lang.TxTOpMasqueTxtE;
            document.querySelector('label[for="OpMasqueTxtS"]').textContent = lang.TxTOpMasqueTxtS;
            document.querySelector('label[for="OpStats"]').textContent = lang.TxTOpStats;
            document.querySelector('label[for="OpDebug"]').textContent = lang.TxTOpDebug;
            document.querySelector('label[for="OpRoadmap"]').textContent = lang.TxTOpRoadmap;
            // Mettre √† jour les l√©gendes des fieldsets
            document.querySelector('form fieldset legend').textContent = lang.TxTOptionsLegend; // L√©gende Options
            document.querySelector('#STATSDIV fieldset legend').textContent = lang.TxTstatsLegend;
            document.querySelector('#DEBUGDIV fieldset legend').textContent = lang.TxTdebugLegend;
            document.querySelector('#ROADMAP fieldset legend').textContent = lang.TxTroadmapLegend;
            // Mettre √† jour le bouton de langue avec SVG
        const languageButton = document.getElementById('languageButton');
            if (currentLanguage === 'fr') {
                languageButton.style.backgroundImage = `url('${getBritishFlagSVG()}')`;
                languageButton.setAttribute('aria-label', 'Switch to English');
            } else {
                languageButton.style.backgroundImage = `url('${getFrenchFlagSVG()}')`;
                languageButton.setAttribute('aria-label', 'Passer au fran√ßais');
            }
            languageButton.value = ''; // Vide la valeur texte
        }
        window.onload = function() {
            updateTexts();
        };
        ////////////////////////////// GESTION DES MASQUAGES DE DIV LORS DES FOCUS
            document.addEventListener('DOMContentLoaded', function() {
                // S√©lectionner les √©l√©ments √† masquer
                const btnAutoCryDec = document.getElementById('BTNautoCryDec');
                const btnEntree = document.getElementById('BTNEntree');
                const btnSortie = document.getElementById('BTNSortie');
                const textareaEntree = document.getElementById('txtareaentree');
                const textareaSortie = document.getElementById('txtareasortie');
                const containerEntree = document.getElementById('containerEntree');
                const containerSortie = document.getElementById('containerSortie');
                    // Fonction unifi√©e pour g√©rer l'affichage des √©l√©ments
                    function gererAffichage(masquer, textareaEnFocus) {
                        // G√©rer les √©l√©ments communs
                        if (btnAutoCryDec) btnAutoCryDec.style.display = masquer ? 'none' : '';
                    if (btnEntree) btnEntree.style.display = masquer ? 'none' : '';
                    if (btnSortie) btnSortie.style.display = masquer ? 'none' : '';
                    // G√©rer les textareas
                    if (masquer) {
                        if (textareaEnFocus === textareaEntree && textareaSortie) {
                            containerSortie.style.display = 'none';
                        } else if (textareaEnFocus === textareaSortie && textareaEntree) {
                            containerEntree.style.display = 'none';
                        }
                    } else {
                        // Si on affiche, r√©afficher les deux textareas
                        if (containerEntree) containerEntree.style.display = '';
                        if (containerSortie) containerSortie.style.display = '';
                    }
                    }
                    // Ajouter des √©couteurs d'√©v√©nements pour textareaEntree
                    if (textareaEntree) {
                        textareaEntree.addEventListener('focus', function() {
                            gererAffichage(true, textareaEntree);
                        });
                        textareaEntree.addEventListener('blur', function() {
                            gererAffichage(false, null);
                        });
                    }
                    // Ajouter des √©couteurs d'√©v√©nements pour textareaSortie
                    if (textareaSortie) {
                        textareaSortie.addEventListener('focus', function() {
                            gererAffichage(true, textareaSortie);
                        });
                        textareaSortie.addEventListener('blur', function() {
                            gererAffichage(false, null);
                        });
                    }
                });
    </script>
</body>
</html>
